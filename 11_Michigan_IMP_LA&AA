11_Michigan_IMP_LA&AA
8/9/17

#LA Pre-Imp Step 1
cd px_prostate_cancer_LA
plink --ped QC6e1.ped --map QC6e1.map --recode vcf --out 6e1
PLINK v1.90b4.3 64-bit (9 May 2017)            www.cog-genomics.org/plink/1.9/
(C) 2005-2017 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to 6e1.log.
Options in effect:
  --map QC6e1.map
  --out 6e1
  --ped QC6e1.ped
  --recode vcf

64070 MB RAM detected; reserving 32035 MB for main workspace.
.ped scan complete (for binary autoconversion).
Performing single-pass .bed write (60596 variants, 2316 people).
--file: 6e1-temporary.bed + 6e1-temporary.bim + 6e1-temporary.fam written.
60596 variants loaded from .bim file.
2316 people (2122 males, 194 females) loaded from .fam.
391 phenotype values loaded from .fam.
Using 1 thread (no multithreaded calculations invoked).
Before main variant filters, 2316 founders and 0 nonfounders present.
Calculating allele frequencies... done.
Total genotyping rate is 0.999117.
60596 variants and 2316 people pass filters and QC.
Among remaining phenotypes, 0 are cases and 391 are controls.  (1925 phenotypes
are missing.)
--recode vcf to 6e1.vcf ... done.

jack@wheelerlab1:~/px_prostate_cancer_LA$ vcf-sort 6e1.vcf|bgzip -c > 6e1.vcf.gz
sort -k1,1d -k2,2n


#Step 2
#http://www.well.ox.ac.uk/~wrayner/tools/ download and extract the .pl file from version 4.2.6. 
#IMPORTANT: The following steps were done with hg19.bim file – this file may be incorrect. Restart at this step with new file if this is the case.
#First create the .frq file needed
plink --bfile /home/jack/px_prostate_cancer_LA/hg19 --freq --out newfreq

#Follow instructions under "Usage with 1000G reference panel"
#-p is left blank because it will default to ALL – however, Japanese will need specifics
perl HRC-1000G-check-bim.pl -b hg19.bim -f newfreq.frq -r /home/wheelerlab1/Data/preImputation-check/1000GP_Phase3_combined.legend -g -p


         Script to check plink .bim files against HRC/1000G for
        strand, id names, positions, alleles, ref/alt assignment
                         William Rayner 2015
                        wrayner@well.ox.ac.uk

                             Version 4.2.6


Option p requires an argument
WARNING: 1000G panel specified and no population selected will default to ALL
Options Set:
Reference Panel:             1000G
Bim filename:                hg19.bim
Reference filename:          /home/wheelerlab1/Data/preImputation-check/1000GP_Phase3_combined.legend
Allele frequencies filename: newfreq.frq
Allele frequency threshold:  0.2
Population for 1000G:        ALL


Reading /home/wheelerlab1/Data/preImputation-check/1000GP_Phase3_combined.legend
 100000 200000 300000 400000 500000 600000 700000 800000 900000 1000000 1100000 1200000 1300000 1400000 1500000 1600000 1700000 1800000 1900000 2000000 2100000 2200000 2300000 2400000 2500000 2600000 2700000 2800000 2900000 3000000 3100000 3200000 3300000 3400000 3500000 3600000 3700000 3800000 3900000 4000000 4100000 4200000 4300000 4400000 4500000 4600000 4700000 4800000 4900000 5000000 5100000 5200000 5300000 5400000 5500000 5600000 5700000 5800000 5900000 6000000 6100000 6200000 6300000 6400000 6500000 6600000 6700000 6800000 6900000 7000000 7100000 7200000 7300000 7400000 7500000 7600000 7700000 7800000 7900000 8000000 8100000 8200000 8300000 8400000 8500000 8600000 8700000 8800000 8900000 9000000 9100000 9200000 9300000 9400000 9500000 9600000 9700000 9800000 9900000 10000000 10100000 10200000 10300000 10400000 10500000 10600000 10700000 10800000 10900000 11000000 11100000 11200000 11300000 11400000 11500000 11600000 11700000 11800000 11900000 12000000 12100000 12200000 12300000 12400000 12500000 12600000 12700000 12800000 12900000 13000000 13100000 13200000 13300000 13400000 13500000 13600000 13700000 13800000 13900000 14000000 14100000 14200000 14300000 14400000 14500000 14600000 14700000 14800000 14900000 15000000 15100000 15200000 15300000 15400000 15500000 15600000 15700000 15800000 15900000 16000000 16100000 16200000 16300000 16400000 16500000 16600000 16700000 16800000 16900000 17000000 17100000 17200000 17300000 17400000 17500000 17600000 17700000 17800000 17900000 18000000 18100000 18200000 18300000 18400000 18500000 18600000 18700000 18800000 18900000 19000000 19100000 19200000 19300000 19400000 19500000 19600000 19700000 19800000 19900000 20000000 20100000 20200000 20300000 20400000 20500000 20600000 20700000 20800000 20900000 21000000 21100000 21200000 21300000 21400000 21500000 21600000 21700000 21800000 21900000 22000000 22100000 22200000 22300000 22400000 22500000 22600000 22700000 22800000 22900000 23000000 23100000 23200000 23300000 23400000 23500000 23600000 23700000 23800000 23900000 24000000 24100000 24200000 24300000 24400000 24500000 24600000 24700000 24800000 24900000 25000000 25100000 25200000 25300000 25400000 25500000 25600000 25700000 25800000 25900000 26000000 26100000 26200000 26300000 26400000 26500000 26600000 26700000 26800000 26900000 27000000 27100000 27200000 27300000 27400000 27500000 27600000 27700000 27800000 27900000 28000000 28100000 28200000 28300000 28400000 28500000 28600000 28700000 28800000 28900000 29000000 29100000 29200000 29300000 29400000 29500000 29600000 29700000 29800000 29900000 30000000 30100000 30200000 30300000 30400000 30500000 30600000 30700000 30800000 30900000 31000000 31100000 31200000 31300000 31400000 31500000 31600000 31700000 31800000 31900000 32000000 32100000 32200000 32300000 32400000 32500000 32600000 32700000 32800000 32900000 33000000 33100000 33200000 33300000 33400000 33500000 33600000 33700000 33800000 33900000 34000000 34100000 34200000 34300000 34400000 34500000 34600000 34700000 34800000 34900000 35000000 35100000 35200000 35300000 35400000 35500000 35600000 35700000 35800000 35900000 36000000 36100000 36200000 36300000 36400000 36500000 36600000 36700000 36800000 36900000 37000000 37100000 37200000 37300000 37400000 37500000 37600000 37700000 37800000 37900000 38000000 38100000 38200000 38300000 38400000 38500000 38600000 38700000 38800000 38900000 39000000 39100000 39200000 39300000 39400000 39500000 39600000 39700000 39800000 39900000 40000000 40100000 40200000 40300000 40400000 40500000 40600000 40700000 40800000 40900000 41000000 41100000 41200000 41300000 41400000 41500000 41600000 41700000 41800000 41900000 42000000 42100000 42200000 42300000 42400000 42500000 42600000 42700000 42800000 42900000 43000000 43100000 43200000 43300000 43400000 43500000 43600000 43700000 43800000 43900000 44000000 44100000 44200000 44300000 44400000 44500000 44600000 44700000 44800000 44900000 45000000 45100000 45200000 45300000 45400000 45500000 45600000 45700000 45800000 45900000 46000000 46100000 46200000 46300000 46400000 46500000 46600000 46700000 46800000 46900000 47000000 47100000 47200000 47300000 47400000 47500000 47600000 47700000 47800000 47900000 48000000 48100000 48200000 48300000 48400000 48500000 48600000 48700000 48800000 48900000 49000000 49100000 49200000 49300000 49400000 49500000 49600000 49700000 49800000 49900000 50000000 50100000 50200000 50300000 50400000 50500000 50600000 50700000 50800000 50900000 51000000 51100000 51200000 51300000 51400000 51500000 51600000 51700000 51800000 51900000 52000000 52100000 52200000 52300000 52400000 52500000 52600000 52700000 52800000 52900000 53000000 53100000 53200000 53300000 53400000 53500000 53600000 53700000 53800000 53900000 54000000 54100000 54200000 54300000 54400000 54500000 54600000 54700000 54800000 54900000 55000000 55100000 55200000 55300000 55400000 55500000 55600000 55700000 55800000 55900000 56000000 56100000 56200000 56300000 56400000 56500000 56600000 56700000 56800000 56900000 57000000 57100000 57200000 57300000 57400000 57500000 57600000 57700000 57800000 57900000 58000000 58100000 58200000 58300000 58400000 58500000 58600000 58700000 58800000 58900000 59000000 59100000 59200000 59300000 59400000 59500000 59600000 59700000 59800000 59900000 60000000 60100000 60200000 60300000 60400000 60500000 60600000 60700000 60800000 60900000 61000000 61100000 61200000 61300000 61400000 61500000 61600000 61700000 61800000 61900000 62000000 62100000 62200000 62300000 62400000 62500000 62600000 62700000 62800000 62900000 63000000 63100000 63200000 63300000 63400000 63500000 63600000 63700000 63800000 63900000 64000000 64100000 64200000 64300000 64400000 64500000 64600000 64700000 64800000 64900000 65000000 65100000 65200000 65300000 65400000 65500000 65600000 65700000 65800000 65900000 66000000 66100000 66200000 66300000 66400000 66500000 66600000 66700000 66800000 66900000 67000000 67100000 67200000 67300000 67400000 67500000 67600000 67700000 67800000 67900000 68000000 68100000 68200000 68300000 68400000 68500000 68600000 68700000 68800000 68900000 69000000 69100000 69200000 69300000 69400000 69500000 69600000 69700000 69800000 69900000 70000000 70100000 70200000 70300000 70400000 70500000 70600000 70700000 70800000 70900000 71000000 71100000 71200000 71300000 71400000 71500000 71600000 71700000 71800000 71900000 72000000 72100000 72200000 72300000 72400000 72500000 72600000 72700000 72800000 72900000 73000000 73100000 73200000 73300000 73400000 73500000 73600000 73700000 73800000 73900000 74000000 74100000 74200000 74300000 74400000 74500000 74600000 74700000 74800000 74900000 75000000 75100000 75200000 75300000 75400000 75500000 75600000 75700000 75800000 75900000 76000000 76100000 76200000 76300000 76400000 76500000 76600000 76700000 76800000 76900000 77000000 77100000 77200000 77300000 77400000 77500000 77600000 77700000 77800000 77900000 78000000 78100000 78200000 78300000 78400000 78500000 78600000 78700000 78800000 78900000 79000000 79100000 79200000 79300000 79400000 79500000 79600000 79700000 79800000 79900000 80000000 80100000 80200000 80300000 80400000 80500000 80600000 80700000 80800000 80900000 81000000 81100000 81200000 81300000 81400000 81500000 81600000 81700000 81800000 81900000 82000000 82100000 82200000 82300000 82400000 82500000 82600000 82700000 82800000 82900000 83000000 83100000 83200000 83300000 83400000 83500000 83600000 83700000 83800000 83900000 84000000 84100000 84200000 84300000 84400000 84500000 84600000 84700000 84800000 84900000 85000000 85100000 Done
Matching to 1000G

Position Matches
 ID matches 1000G 0
 ID Doesn't match 1000G 173819
 Total Position Matches 173819
ID Match
 Different position to 1000G 15
No Match to 1000G 486
Skipped (X, XY, Y, MT) 0
Total in bim file 174320
Total processed 174320

Indels (ignored in r1) 0

SNPs not changed 25191
SNPs to change ref alt 122398
Strand ok 86465
Total Strand ok 147589

Strand to change 86106
Total checked 173834
Total checked Strand 172571
Total removed for allele Frequency diff > 0.2 2998
Palindromic SNPs with Freq > 0.4 69


Non Matching alleles 1194
ID and allele mismatching 1194; where 1000G is . 0
Duplicates removed 0

#AA Steps
#You will be following the CAAPA instructions on the Michigan Server for these steps
#First create the .frq file needed with your hg19 file
plink --bfile /home/jack/px_prostate_cancer_LA/hg19 --freq --out newfreq

#Copy the HRC file from the LA directory
cp /home/jack/px_prostate_cancer_LA/HRC-1000G-check-bim.pl .

#Now you have all the files needed to make the chromosome files
#The CAAPA Reference file is within wheelerlab1 because it’s too big
perl HRC-1000G-check-bim.pl -b hg19.bim -f newfreq.frq -r /home/wheelerlab1/Data/preImputation-check/all.caapa.sorted.txt -h


         Script to check plink .bim files against HRC/1000G for
        strand, id names, positions, alleles, ref/alt assignment
                         William Rayner 2015
                        wrayner@well.ox.ac.uk

                             Version 4.2.6


Options Set:
Reference Panel:             HRC
Bim filename:                hg19.bim
Reference filename:          /home/wheelerlab1/Data/preImputation-check/all.caap                                                                             a.sorted.txt
Allele frequencies filename: newfreq.frq
Allele frequency threshold:  0.2


Reading /home/wheelerlab1/Data/preImputation-check/all.caapa.sorted.txt
 100000 200000 300000 400000 500000 600000 700000 800000 900000 1000000 1100000                                                                              1200000 1300000 1400000 1500000 1600000 1700000 1800000 1900000 2000000 2100000                                                                              2200000 2300000 2400000 2500000 2600000 2700000 2800000 2900000 3000000 3100000                                                                              3200000 3300000 3400000 3500000 3600000 3700000 3800000 3900000 4000000 4100000                                                                              4200000 4300000 4400000 4500000 4600000 4700000 4800000 4900000 5000000 5100000                                                                              5200000 5300000 5400000 5500000 5600000 5700000 5800000 5900000 6000000 6100000                                                                              6200000 6300000 6400000 6500000 6600000 6700000 6800000 6900000 7000000 7100000                                                                              7200000 7300000 7400000 7500000 7600000 7700000 7800000 7900000 8000000 8100000                                                                              8200000 8300000 8400000 8500000 8600000 8700000 8800000 8900000 9000000 9100000                                                                              9200000 9300000 9400000 9500000 9600000 9700000 9800000 9900000 10000000 1010000                                                                             0 10200000 10300000 10400000 10500000 10600000 10700000 10800000 10900000 110000                                                                             00 11100000 11200000 11300000 11400000 11500000 11600000 11700000 11800000 11900                                                                             000 12000000 12100000 12200000 12300000 12400000 12500000 12600000 12700000 1280                                                                             0000 12900000 13000000 13100000 13200000 13300000 13400000 13500000 13600000 137                                                                             00000 13800000 13900000 14000000 14100000 14200000 14300000 14400000 14500000 14                                                                             600000 14700000 14800000 14900000 15000000 15100000 15200000 15300000 15400000 1                                                                             5500000 15600000 15700000 15800000 15900000 16000000 16100000 16200000 16300000                                                                              16400000 16500000 16600000 16700000 16800000 16900000 17000000 17100000 17200000                                                                              17300000 17400000 17500000 17600000 17700000 17800000 17900000 18000000 1810000                                                                             0 18200000 18300000 18400000 18500000 18600000 18700000 18800000 18900000 190000                                                                             00 19100000 19200000 19300000 19400000 19500000 19600000 19700000 19800000 19900                                                                             000 20000000 20100000 20200000 20300000 20400000 20500000 20600000 20700000 2080                                                                             0000 20900000 21000000 21100000 21200000 21300000 21400000 21500000 21600000 217                                                                             00000 21800000 21900000 22000000 22100000 22200000 22300000 22400000 22500000 22                                                                             600000 22700000 22800000 22900000 23000000 23100000 23200000 23300000 23400000 2                                                                             3500000 23600000 23700000 23800000 23900000 24000000 24100000 24200000 24300000                                                                              24400000 24500000 24600000 24700000 24800000 24900000 25000000 25100000 25200000                                                                              25300000 25400000 25500000 25600000 25700000 25800000 25900000 26000000 2610000                                                                             0 26200000 26300000 26400000 26500000 26600000 26700000 26800000 26900000 270000                                                                             00 27100000 27200000 27300000 27400000 27500000 27600000 27700000 27800000 27900                                                                             000 28000000 28100000 28200000 28300000 28400000 28500000 28600000 28700000 2880                                                                             0000 28900000 29000000 29100000 29200000 29300000 29400000 29500000 29600000 297                                                                             00000 29800000 29900000 30000000 30100000 30200000 30300000 30400000 30500000 30                                                                             600000 30700000 30800000 30900000 31000000 31100000 31200000 31300000 31400000 3                                                                             1500000 31600000 31700000 31800000 31900000 32000000 32100000 32200000 32300000                                                                              32400000 32500000 32600000 32700000 32800000 32900000 33000000 33100000 33200000                                                                              33300000 33400000 33500000 33600000 33700000 33800000 33900000 34000000 3410000                                                                             0 34200000 34300000 34400000 34500000 34600000 34700000 34800000 34900000 350000                                                                             00 35100000 35200000 35300000 35400000 35500000 35600000 35700000 35800000 35900                                                                             000 36000000 36100000 36200000 36300000 36400000 36500000 36600000 36700000 3680                                                                             0000 36900000 37000000 37100000 37200000 37300000 37400000 37500000 37600000 377                                                                             00000 37800000 37900000 38000000 38100000 38200000 38300000 38400000 38500000 38                                                                             600000 38700000 38800000 38900000 39000000 39100000 39200000 39300000 39400000 3                                                                             9500000 39600000 39700000 39800000 39900000 40000000 40100000 40200000 40300000                                                                              40400000 40500000 40600000 40700000 40800000 40900000 41000000 41100000 41200000                                                                              41300000 41400000 41500000 41600000 41700000 41800000 41900000 42000000 4210000                                                                             0 42200000 42300000 42400000 42500000 42600000 42700000 42800000 42900000 430000                                                                             00 43100000 43200000 43300000 43400000 43500000 43600000 43700000 43800000 43900                                                                             000 44000000 44100000 44200000 44300000 44400000 44500000 44600000 44700000 4480                                                                             0000 44900000 45000000 45100000 45200000 45300000 45400000 45500000 45600000 457                                                                             00000 45800000 45900000 46000000 46100000 46200000 46300000 46400000 46500000 46                                                                             600000 46700000 46800000 46900000 47000000 47100000 47200000 47300000 47400000 4                                                                             7500000 47600000 47700000 47800000 47900000 48000000 48100000 48200000 48300000                                                                              48400000 48500000 48600000 48700000 48800000 48900000 49000000 49100000 49200000                                                                              49300000 49400000 49500000 49600000 49700000 49800000 49900000 50000000 5010000                                                                             0 50200000 50300000 50400000 50500000 50600000 50700000 50800000 50900000 510000                                                                             00 51100000 51200000 51300000 51400000 51500000 51600000 51700000 51800000 51900                                                                             000 52000000 52100000 52200000 52300000 52400000 52500000 52600000 52700000 5280                                                                             0000 52900000 53000000 53100000 53200000 53300000 53400000 53500000 53600000 537                                                                             00000 53800000 53900000 54000000 54100000 54200000 54300000 54400000 54500000 54                                                                             600000 54700000 54800000 54900000 55000000 55100000 55200000 55300000 55400000 5                                                                             5500000 55600000 55700000 55800000 55900000 56000000 56100000 56200000 56300000                                                                              56400000 56500000 56600000 56700000 56800000 56900000 57000000 57100000 57200000                                                                              57300000 57400000 57500000 57600000 57700000 57800000 57900000 58000000 5810000                                                                             0 58200000 58300000 58400000 58500000 58600000 58700000 58800000 58900000 590000                                                                             00 59100000 59200000 59300000 59400000 59500000 59600000 59700000 59800000 59900                                                                             000 60000000 60100000 60200000 60300000 60400000 60500000 60600000 60700000 6080                                                                             0000 60900000 61000000 61100000 61200000 61300000 61400000 61500000 61600000 617                                                                             00000 61800000 61900000 62000000 62100000 62200000 62300000 62400000 62500000 62                                                                             600000 62700000 62800000 62900000 63000000 63100000 63200000 63300000 63400000 6                                                                             3500000 63600000 63700000 Done
Matching to HRC

Position Matches
 ID matches HRC 381310
 ID Doesn't match HRC 14308
 Total Position Matches 395618
ID Match
 Different position to HRC 64
No Match to HRC 7120
Skipped (X, XY, Y, MT) 0
Total in bim file 402984
Total processed 402802

Indels (ignored in r1) 182

SNPs not changed 77084
SNPs to change ref alt 291306
Strand ok 326854
Total Strand ok 368390

Strand to change 63883
Total checked 395682
Total checked Strand 390737
Total removed for allele Frequency diff > 0.2 1281
Palindromic SNPs with Freq > 0.4 997


Non Matching alleles 3948
ID and allele mismatching 3704; where HRC is . 3702
Duplicates removed 0

#Now use the “bash” command on the new created file “Run-plink.sh” to get all 22 chromosome files
bash Run-plink.sh

#Check to see you have all 22 files (each should have an individual .bed .bim .fam .log set of files)
ls Run-plink.sh

#Now you must convert them to individual .vcf.gz files for each chromosome
#Run this for each one:
plink –-bfile hg19-updated-chr1 -–recode vcf –out hg19-updated-chr1

#Then run:
vcf-sort hg19-updated-chr1.vcf | bgzip -c > hg19-updated-chr1.vcf.gz

#Finally, you may want to make a directory that holds only the .gz chromosome files for the sake of neatness
mkdir Imputation_gz

#Now you’re ready to upload them to Michigan. If the Wheelerlab1 computer is working, log into Michigan and put them there. If not, here are the instructions for uploading them from any of the lab terminals:
Guanine-Mac-Mini: Imputation guanine$ scp -r jack@10.23.17.131:/home/jack/px_prostate_cancer_AA/Imputation ~/Imputation
